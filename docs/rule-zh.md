# 游戏规则文档
# 芯机暗涌:王者对决--AI智能体狼人杀极限挑战赛


## 一、赛事总览
“芯机暗涌:王者对决”是一场高规格、强对抗的AI编程竞赛。本次大赛以经典的狼人杀游戏为载体，挑战参赛者构建性能至上的AI智能体。我们不仅仅满足于AI的“拟人化”，而是追求在复杂博弈环境下的最高胜率和最优策略。

赛事的核心理念是：**“胜率是检验真理的唯一标准”**。80%的评分将直接由AI在海量对局中的表现决定。我们寻找的，是能在数字战场上运筹帷幄、百战不殆的“AI狼王”。


## 二、赛事定位与目标
### 核心定位
一场以竞技表现为绝对核心的顶级AI博弈挑战赛。

### 主要目标
1. 追求极限性能：激励参赛者突破常规，运用任何有效的编程、逻辑或AI策略，设计出最具统治力的狼人杀AI。
2. 树立技术标杆：通过大规模、标准化的对局，客观地衡量和筛选出当前最优的AI博弈策略，为后续研究提供基准。
3. 深化工程实践：即便在性能优先的导向下，依然要求参赛者遵循规范的工程化标准提交作品，培养“高效能”与“高质量”兼备的开发习惯。
4. 打造顶级观赏盛宴：通过专业的可视化和解说，将高水平AI之间的策略碰撞，呈现为一场引人入胜的智力竞技。


## 三、竞技场搭建（基于 liars-bar-llm）
### 游戏引擎
采用 liars-bar-llm 开源框架进行改进作为比赛的官方引擎，确保规则的统一性、稳定性与公平性。

### 比赛环境
- **对局配置**：为保证策略深度和可比性，所有比赛均采用统一的 9人标准局（3狼人、3平民、预言家、女巫、猎人）。
- **模型与资源**：由主办方统一提供主流大语言模型（LLM）的API接口和调用凭证，并设定严格的单回合Token使用上限和响应时间限制（例如：10秒），考验AI的决策效率。

### AI接口协议
1. 比赛引擎将通过HTTP POST请求与参赛AI进行通信。
2. 每当轮到AI行动时，引擎会将包含完整公开信息和当前玩家私有信息的 `game_state` JSON对象发送至AI指定的API端点。
3. AI服务必须在规定时间内响应一个包含决策结果的JSON对象。超时或格式错误将被视为无效行动（例如，放弃投票或技能）。


## 四、参赛产物规范
参赛者必须提交一个可独立部署和运行的 **“AI智能体工程包”**，这是AI参加比赛的唯一凭证。

### 目录结构
```
submission/
├── agent/ # 基线程序包
├── config.yaml # AI 配置文件 (模型参数、策略开关等)
├── prompts/ # 模块化的Prompt文件，用于不同身份等
└── readme.md # 工程与策略说明书
```

### 核心要求
- **可部署性**：工程包必须能通过简单的命令（如 `python main.py`）启动一个符合接口协议的 Web服务。
- **独立性**：AI决策所需的所有逻辑、Prompt和配置都必须包含在工程包内。


## 五、AI接口与数据规范
### 输入：game_state（请求体）
一个包含全局信息和私有信息的复杂JSON对象，详细定义了当前回合数、玩家状态、历史发言、历史投票、技能使用情况、自己的身份牌、收到的私密信息（如查验结果）等。

### 输出：decision（响应体）
AI必须返回一个严格遵守格式的JSON，关键字段如下：
```json
{
  "natural_speech": "...", // 用于观赏和表达的自然语言发言
  "vote_target": 5, // 明确的投票目标玩家ID
  "skill_target": 1, // 明确的技能使用目标ID (若适用)
  "reasoning_steps": [ ... ], // (用于计分) 决策过程的思考链
  "suspicion_scores": { ... } // (用于计分) 对场上玩家的怀疑度评估
}
```

## 六、比赛流程
1. **报名与技术培训（第九、十周）**：
   - 开放报名，发布详细的技术文档和包含Web服务模板的Baseline基线工程包。
   - 举办线上技术讲座，深度解析 Werewolf-llm 框架和比赛API。

2. **初赛：天梯积分排位赛（第十一、十二周）**：
   - 参赛队伍将AI部署并提交API端点至线上天梯系统。
   - 系统在2周内7x24小时不间断地自动匹配不同AI进行海量对局（预计每支队伍会进行数百场对局）。
   - 系统根据每局比赛的详细积分，实时计算并更新天梯排名。此阶段允许队伍3次更新其AI版本。

3. **决赛：巅峰对决循环赛（第十四周周末）**：
   - 天梯排名前9的队伍进入决赛
   - 决赛将以线下直播的形式进行，采用双败淘汰制或循环赛制，决出最终的冠军、亚军和季军。
   - 决赛期间，AI的 `reasoning_steps` 和 `suspicion_scores` 将被实时投射到大屏幕上，供解说和观众分析。

## 七、游戏流程简述
游戏分为昼夜两部分，循环进行直至某一阵营达成胜利条件。
### 初始准备阶段
   - 所有玩家随机分配身份，身份为：3村民+3狼人+1女巫+1猎人+1预言家。
   - 为所有玩家随机安排发言顺序。
   - 游戏从第一夜开始。

### 一、夜晚阶段（所有玩家闭眼，按固定顺序行动）
1. **狼人行动（首项，限时1分钟）**  
   - 狼人智能体在**专属私密对话频道**协商击杀目标，最终需向主持人提交1个“要刀的玩家序号”（仅支持单个序号，多序号视为无效操作）。
     - 专属私密对话（仅限狼人与主持人知晓）：狼人依次（按照序号大小）给出且只能给出所选择击杀目标（不可讨论其他信息），遵循少数服从多数原则最终决定“要刀的玩家序号”。
     - 若出现平票则再次让狼人依次选择一轮，若第二次出现平票，则随机选取平票玩家之一作为击杀目标。 
     - 狼人可以选择“自刀”。  
   - 操作结束后，被刀的玩家立即死亡，狼人闭眼，进入下一轮角色行动。

2. **女巫行动（紧接狼人，无固定限时，以主持人提示为准）**  
   - 首先确定女巫存活状态，若女巫死亡则女巫环节结束。
   - 主持人首先告知女巫“狼人击杀目标序号”。  
   - 女巫可选择以下操作之一：  
     ① 用解药：仅当女巫有解药时可用，选择“救该击杀目标”（解药使用后永久消耗，后续夜晚无法再救）；  
     ② 用毒药：选择1名存活玩家序号毒杀（毒药使用后永久消耗，与解药可同晚使用）；  
     ③ 不用药：既不救也不毒，直接告知主持人“空过”。 
   - 被毒杀玩家立即死亡。 
   - 操作结束后，女巫闭眼。

3. **预言家行动（紧接女巫，无固定限时）**  
   - 首先确定预言家存活状态，若预言家死亡则预言家环节结束。
   - 预言家向主持人提交1个“查验目标序号”，主持人立即反馈查验结果（仅告知预言家本人）：结果为“好人”（含平民/神职）或“狼人”，无法查验具体角色（如分不清是平民还是猎人）。  
   - 操作结束后，预言家闭眼。

4. **猎人行动（最后一项，仅获取状态，无需主动操作）**  
   - 主持人单独告知猎人“当前是否具备开枪资格”（即“猎人是否当夜死亡“）：      
   - 若猎人具备开枪资格，且猎人选择开枪，则猎人立即向主持人提交1个开枪序号。  
   - 被开枪者立即死亡。
   - 操作结束后，猎人闭眼，夜晚阶段结束。

### 二、白天阶段（所有存活玩家睁眼，按流程依次进行）
1. **宣布昨夜结果（首项）**  
   - 主持人向所有玩家公布：昨夜死亡玩家序号（若无人死亡，则宣布“昨夜平安夜，无人死亡”）；

2. **顺序发言环节**  
   - 发言顺序：从当前序号最小的玩家开始。  
   - 发言规则：每人仅1次发言机会，限时2分钟（300字），发言时不可打断他人，可陈述自身身份（如跳神职、发金水）、分析昨夜结果、质疑其他玩家、给出投票建议；未发言玩家需保持安静，不可传递场外信息。

3. **投票环节**  
   - 投票规则：主持人宣布“开始投票”后，所有存活玩家需在限时内（30秒）提交1个“怀疑对象序号”（即投票给认为是狼人的玩家），可选择“不投票”（视为弃票，不计入得票统计）。  
   - 投票结果处理：  
     ① 得票最多者：立即死亡，若该玩家是猎人，可立即亮明身份，向主持人提交“开枪目标序号”，被开枪者同步死亡（猎人开枪后无遗言）；  
     ② 平票处理：若多名玩家得票相同且为最高票，触发补充“PK环节”——平票玩家依次进行1分钟发言，其余玩家再次投票（仅可投平票玩家或弃票），若再次平票，则本轮无人死亡，直接进入下一夜。  
   - 投票结束后，进入遗言环节。

4. **遗言环节（仅特定情况触发）**  
   - 有遗言资格的玩家：白天被投票出局的玩家（每轮仅1人，若无人出局则无）。
   - 若没有具备遗言资格的玩家，则本环节跳过，白天阶段结束，游戏进入下一轮昼夜循环。  
   - 遗言限时2分钟（300字），内容可包含身份说明、怀疑对象、信息传递（如预言家报验人、女巫报用药情况），遗言结束后死亡玩家退出白天讨论，不可再发言/投票。
   - 白天阶段结束，游戏进入下一轮昼夜循环。

### 三、胜负判定时机与规则
- 有人死亡（刀人，毒人，猎人开枪，投票）时，主持人立即检查胜负条件：  
  1. 狼人阵营胜利：满足“屠边”任一条件——① 所有3名神职（预言家/女巫/猎人）均死亡；② 所有3名平民均死亡。  
  2. 好人阵营胜利：所有3名狼人均死亡。  
- 若达成胜利条件，主持人立即宣布游戏结束及获胜阵营；若未达成，则继续进行游戏。

## 八、评分标准
### A. 游戏表现分（80%）
此分数完全由AI在对局中的实际表现量化得出，旨在最客观地评估AI的绝对实力。  
计分方式：采用详细积分规则（下述），将其作为计算 **“单局表现分(Game Performance Point, GPP)”** 的基础。 
说明： *评分统计结果将按照玩家身份进行五维呈现（预言家/女巫/猎人/村民/狼人）以帮助参赛者改进Agent，理论上Agent扮演不同身份的概率相等，最终平均GPP仍由所有对局结果得出*  ；*鼓励使用骗人等策略牺牲过程分赚取结果分*   
#### **详细积分规则** 
#### **Basic**
| 项目     | 描述                     | 分值                                         | 注释                                                   |
| -------- | ------------------------ | -------------------------------------------- | ------------------------------------------------------ |
| 胜利积分 | 好人阵营胜利             | +30 GPP                                      |                                                        |
|          | 狼人阵营胜利             | +35 GPP                                      | 相较于好人阵营，狼人阵营胜利难度更大，因此胜利积分更多 |
| 生存积分 | 从第二夜开始每多存活一天 | +2 GPP/天                                    |                                                        |  |
| 投票正确 | 好人投票给狼人           | 若 于第2/3/4天 投票正确则对应 + 4/3/1 GPP/次 |                                                        |
|          | 狼人投票给好人           | 0                                            | 理所应当，不予加分                                     |
| 投票失误 | 好人投票给好人           | -2  GPP/次                                   |                                                        |
|          | 狼人投票给狼人           | -2  GPP/次                                   |                                                        |
####  **Bonus**  
| 项目   | 描述               | 分值                          | 注释                                                                                                       |
| ------ | ------------------ | ----------------------------- | ---------------------------------------------------------------------------------------------------------- |
| 预言家 | 成功查验到狼人     | +2 GPP/次                     |                                                                                                            |
|        | 成功查验到好人     | +1 GPP/次                     |                                                                                                            |
|        | 神职能力的代价     | -1 GPP/天                     | 预言家的代价；考虑到当预言家亮明身份后会死的比较快，此扣分相当于鼓励预言家跳出来说话                       |
| 女巫   | 成功救活好人       | +4 GPP                        |                                                                                                            |
|        | 成功毒死狼人       | +4 GPP                        |                                                                                                            |
|        | 女巫救错/毒错      | -4 GPP/次                     |                                                                                                            |
|        | 神职能力的代价     | -1 GPP/天                     | 女巫的代价                                                                                                 |
| 猎人   | 成功击杀狼人       | +8 GPP                        |                                                                                                            |
|        | 错误击杀好人       | -10 GPP                       |                                                                                                            |
|        | 被动神职能力无代价 | 0                             |                                                                                                            |
| 村民   | 投票正确额外加成   | 由 +2 GPP/次 修改为 +3 GPP/次 |
|        | 投票错误惩罚减轻   | 由 -2 GPP/次 修改为 -1 GPP/次 | 这是因为村民作为投票的跟随者，没有信息源，没有其他的加分方法，所以投票正确应有较大奖励，错误应有较小惩罚。 |
| 狼人   | 身份隐藏加成       | 由 +2 GPP/天 修改为 +3 GPP/天 | 鼓励狼人身份的隐藏                                                                                         |

#### 最终分数计算
- **初赛（天梯赛）**：取一支队伍所有对局的 **平均GPP** 作为其初赛成绩。例如，A队打了200局，总GPP为1200，则其平均分为6.0。
- **决赛**：根据决赛的赛制，计算决赛阶段的平均GPP。
- **最终游戏表现分** =（初赛平均GPP × 0.7）+（决赛平均GPP × 0.3），然后将所有队伍的此项得分进行归一化，映射到100分的总分区间内。


### B. 工程与逻辑分（20%）
此分数由专家评委会根据参赛者提交的工程包和决赛表现进行综合评定。它是AI强度之外的质量体现，也是顶尖AI之间对决胜负的关键手。

1. **工程质量（10%）**
   - 健壮性与效率（5%）：代码运行是否稳定？API响应是否高效？是否存在明显的性能瓶颈？
   - 结构与规范（5%）：项目结构是否清晰？是否有效利用配置文件（`config.yaml`）进行策略参数化？代码风格和文档（`readme.md`）是否专业？

2. **逻辑与表达（10%）**
   - 逻辑可解释性（7%）：AI输出的 `reasoning_steps` 和 `suspicion_scores` 是否与其最终行为（投票、技能）高度一致？思考链是否展现了深度和洞察力？
   - 表达得体性（3%）：`natural_speech` 是否符合角色身份？发言是有效信息还是无意义的噪声？（例如，一个优秀的预言家AI，其发言应具有引导性，而非仅仅陈述事实）。


## 九、奖项设置
- **特等奖**：1个团队/个人，奖金10000元 + 证书
- **一等奖**：1个团队/个人，奖金8000元 + 证书
- **二等奖**：2个团队/个人，奖金5000元 + 证书
- **三等奖**：4个团队/个人，奖金3000元 + 证书


## 十、赛事亮点
1. **高强度对抗**：海量的自动化对局将对AI的稳定性和适应性提出极限考验。
2. **数据驱动的“内心戏”**：将AI的思考过程和怀疑度量化，并通过可视化呈现给观众，提供前所未有的观赛体验。
3. **王者荣耀**：冠军不仅是荣誉，其AI的设计哲学和核心代码（经作者同意后）将被作为“名人堂”作品，成为未来赛事的标杆和挑战对象。


## 十一、规则说明与裁定
- **规则解释权**：所有规则将由比赛主办方负责解释，比赛中如果出现未预见的问题，裁判团队将根据既定规则进行裁定。
- **作弊防范**：比赛中禁止任何形式的作弊行为，包括但不限于利用外部工具修改游戏数据、恶意利用游戏漏洞等。发现作弊行为的队伍将被立即取消比赛资格。


## 十二、预期参与人数与影响力
- **直接参与**：预计30支左右队伍，100余名选手，来自全校各个院系，主要是大一大二同学。
- **现场观众**：每场预计120人，含参赛选手、学生、教师。
- **线上传播**：通过B站等平台直播与回顾。
- **品牌曝光**：赛事背景板、物料、奖杯、证书、直播口播、选手补给等均可嵌入品牌元素。


## 十三、赞助回报
1. 在比赛各阶段的宣传工作中，包括但不限于清华主干道、紫荆公寓前的巨型宣传板，赛事手册，宣传新闻材料以及自动化系学生会官方公众号宣传推送上，注明赞助商名称和标志。赛事主题可用赞助企业名称或品牌名称进行冠名。
2. 在赛事路演活动现场，可放置赞助商宣传海报或易拉宝，可摆放赞助商产品供来往学生试用。
3. 在初赛和决赛晚会现场，可提供多次主持人口播以感谢并向观众宣传赞助商，在晚会开场前可播放赞助商宣传视频。晚会现场也将邀请贵公司的代表前来参加活动并进行演讲，进一步加深观众对贵公司的认知与好感。
4. 在赛事晚会的奖品中，可指定部分奖品为赞助商产品或周边文创，提升赞助商产品在清华大学同学中的知名度，促使更多学生用户购买使用产品，极大提升品牌影响力。
5. 自动化系学生会官方公众号可为赞助商发布宣传或招聘推送，促进品牌推广和人才招募。可组织系内同学前往赞助商公司实地参访。
6. 更为丰富更为具体的宣传方案可根据贵公司和科协的实际情况商议而定。
<!-- TODO: finish -->
